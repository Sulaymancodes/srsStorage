<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
</head>
<body>
    <nav> 
        <a href="/log-out">Logout</a>
    </nav>
    <main>
        <h1>Welcome to HomePage, <%= username %>!</h1>
        <button id="create-folder-btn">Add a Folder</button>

        <!-- Create Folder Dialog -->
        <dialog id="create-folder">
            <form action="/create-folder" method="post">
                <h1>Create Folder</h1>
                <label for="folderName">Name</label>
                <input type="text" name="folderName" required />
                <button type="submit">Create</button>
            </form>
            <button id="close-popup">Close</button>
        </dialog>

        <h2>Folders</h2>
        <% if (folders.length > 0) { %>
            <% folders.forEach((folder, index) => { %>
                <div>
                    <a href="/<%= folder.id %>/folder"><%= folder.name %></a>

                    <!-- Update Folder Form -->
                    <dialog id="update-folder-form-<%= index %>">
                        <form action="/update-folder/<%= folder.id %>" method="post" style="display:inline;">
                            <input type="text" name="newName" placeholder="New Folder Name" value="<%= folder.name %>" required />
                            <button type="submit">Update</button>
                        </form>
                        <button class="close-update-form-popup" data-index="<%= index %>">Close</button>
                    </dialog>
                    
                    <button class="update-btn" data-index="<%= index %>">Edit</button>
                    
                    <!-- Delete Folder Form -->
                    <form action="/delete-folder/<%= folder.id %>" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this folder?');">Delete</button>
                    </form>
                </div>
            <% }) %>
        <% } else { %> 
            <p>No folders yet. Click the Add a Folder button to create one.</p>
        <% } %>
    </main>

    <script>
        // Dialogs
        const folderDialogue = document.getElementById("create-folder");
        const createFolderBtn = document.getElementById("create-folder-btn");
        const closeBtn = document.getElementById("close-popup");

        // Open the create folder dialog
        createFolderBtn.addEventListener("click", () => {
            folderDialogue.showModal();
        });

        // Close the create folder dialog
        closeBtn.addEventListener("click", () => {
            folderDialogue.close();
        });

        // Handle "Edit" buttons and corresponding dialogs
        const updateBtns = document.querySelectorAll(".update-btn");
        updateBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                const index = btn.getAttribute("data-index");
                const dialog = document.getElementById(`update-folder-form-${index}`);
                dialog.showModal();
            });
        });

        // Handle "Close" buttons in update dialogs
        const closeUpdateBtns = document.querySelectorAll(".close-update-form-popup");
        closeUpdateBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                const index = btn.getAttribute("data-index");
                const dialog = document.getElementById(`update-folder-form-${index}`);
                dialog.close();
            });
        });
    </script>
</body>
</html>
